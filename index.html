<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Social Data Analysis and Visualization: Assignment 2</title>
		<script type="text/javascript" src="../d3/d3.js"></script>
		<style type="text/css">
		
			#page-wrap {
				width: 900px;
				margin: 0 auto;
				text-align: left;
			}
				
			body {
				text-align: center;
			}
			
			.axis path,
			.axis line {
				fill: none;
				stroke: black;
				shape-rendering: crispEdges;
			}
			
			.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}
			
			.tooltip {
				position: absolute;
				width: 200px;
				height: 28px;
				pointer-events: none;
			}
			
			.dot {
				stroke: #000;
			}
			
			.button {
				display: inline-block;
				padding: 12px 16px;
				font-size: 15px;
				cursor: pointer;
				text-align: center;	
				text-decoration: none;
				outline: none;
				box-shadow: 0 1px #999;
				background-color: white; 
				color: black; 
				border: 2px solid #555555;
			}

			.button:active {
				transform: translateY(2px);
			}
			
			.bar:hover {
				fill: orange;
			}
			
			.background {
				fill: #eee;
			}

			.centroid{}
			.point{}
		</style>
	</head>
	<body>
		<div id="page-wrap">
		<!--<h1>Visualizing Crime Data in San Fransisco</h1>-->
		<h1><a href="http://www.kurser.dtu.dk/02806.aspx?menulanguage=en-gb">Social Data Analysis and Visualization</a>: 
		<a href="https://github.com/suneman/socialdataanalysis2016/blob/master/assignments/Assignment2.ipynb">Assignment 2</a></h1>
		
		<p><br></p>
		
		<h2>Assignment 2A: Simple SVG stuff</h2>
		<p></p>
		<p><b>Showcasing familiarity with javascript and svg elements.</b> <br>
			<li>There is a gray boundary of width 2 around each square.</li>
			<li>Ssquares are increasingly transparant from left to right.</li>
			<li>Squares have a size of 80 by 80.</li>
			<li>Squares go from bottom of the SVG element to the top.</li>
		</p>
		<p></p>		
		<svg id="simplesvg">
			<rect x="0" y="60" width="80" height="80" fill="rgba(128, 0, 128, 1.0)" stroke="rgba(128,128,0, 1.0)" stroke-width="2"/>
			<rect x="50" y="50" width="80" height="80" fill="rgba(0, 0, 255, 0.75)" stroke="rgba(128,128,0), 0.75" stroke-width="2"/>
			<rect x="100" y="40" width="80" height="80" fill="rgba(0, 255, 0, 0.5)" stroke="rgba(128,128,0, 0.5)" stroke-width="2"/>
			<rect x="150" y="30" width="80" height="80" fill="rgba(255, 255, 0, 0.25)" stroke="rgba(128,128,0, 0.25)" stroke-width="2"/>
			<rect x="200" y="20" width="80" height="80" fill="rgba(255, 0, 0, 0.1)" stroke="rgba(128,128,0, 0.1)" stroke-width="2"/>		
		</svg>
		<p><br></p>
		
		<h2>Assignment 2B: One scatter plot and two datasets</h2>
		<h3>Number of Prostitution and Vehicle Theft Incidents in San Fransisco Districts</h3>
		<p></p>
		<h3><b>Visualization:</b></h3>
		<p>The following visualization consists of an interactive <b>scatterplot</b>, depicting the number of <b>Prostitution</b> and <b>Vehicle Theft</b> Incidents
			in San Fransisco. <br>
			<li>You can freely toggle between year 2003 and 2015 and see how the number of incidents changed between these two years.</li>
			<li>You can hover over every district point and see details about the district and the number of incidents of each type of crime separately</li>
		</p>
		<h3><b>Theoretical Question:</b></h3>
		<p>Explain in your own words why you think I want the axes to be the same for both years? (Even though you know how to make axes adapt to the data values.)</p>
		<p></p>
		<p>Because with static axes one can observe the change in the number of crime incidents between the two years, whilst if the axes
		were dynamically changing the reader would see the axes' ticks to change but the scatter plot points to remain almost stationary. Thus,
		they would not be able to pay attention to how much the crime rate dropped between 2003 to 2015 in every district and for every crime. </p>
		<p></p>
		<button id="button2003" class="button" style="background-color:#008CBA;" >2003</button>
		<button id="button2015" class="button" >2015</button>
		<p></p>
		<div id="area1"></div>
		
		<p><br></p>
		<p></p>
		
		<h2>Assignment 2C: One barchart and (at least) two datasets</h2>
		<h3>Evolution of Crimes in San Fransisco by hour</h3>
		<p></p>
		<h3><b>Visualization:</b></h3>
		<p>The following visualization consists of an interactive <b>histogram</b>, depicting the number of <b>Prostitution</b>, <b>Vehicle Theft</b>  
			and <b>Trespass</b> Incidents in San Fransisco by hour. <br>
			<li>You can freely toggle between different crimes and see how the number of incidents changes during the day.</li>
			<li>You can hover over every bar to highlight it and see detailed number of incidents.</li>
		</p>
		<p></p>
		<button id="Prostitution" class="button" style="background-color:#008CBA;" >Prostitution</button>
		<button id="VehicleTheft" class="button" >Vehicle Theft</button>
		<button id="Trespass" class="button" >Trespass</button>
		<p></p>
		<p></p>
		<div id="area2"></div>
		
		<p><br></p>
		<p></p>
		
		<h2>Assignment 2D: Visualizing geodata</h2>
		<h3>K Means Clustering for Prostitution Crimes in San Fransisco</h3>
		<p></p>
		<h3><b>Visualization:</b></h3>
		<p>The following visualization consists of an interactive <b>map</b>, depicting the classification of <b>Prostitution</b> Incidents in San Fransisco 
			using the <b>K Means</b> clustering algorithm for different numbers of <b>K</b>. Each of the K centroids is shown as a large colored dot 
			and all GPS points belonging to that centroid are colored in relation to it.<br>
			<li>You can freely toggle between different numbers of K and see how the classification of incidents changes in different groups.</li>
			<li>You can hover over every K button to preview the changes and click on it to activate that view.</li>
		</p>
		<h3><b>Algorithm Implementation and Data Preparation:</b></h3>
		<p>The <b>K Means</b> Algorithm was implemented in <b>Python</b> using the <b>sklearn</b> library.
		This implementation along with the preparation of the corresponding data files is documented in <a href="../K means preparation.ipynb">
		an iPython Notebook</a>.</p>
		<h3><b>Theoretical Question:</b></h3>
		<p>Think carefully about how you can minimize the size of the file containing the data. My file is around 700KB. 
		Why is the size of the file important?</p>
		<p></p>
		<p>D3.js is written in JavaScript which is a client-side script language. The CSV files must be downloaded from the server to the client in order to be loaded by D3.js. 
		As a result, larger files take a longer time to be displayed since they have to be downloaded and all their rows and columns (more with a bigger file) are processed.</p>
		<p></p>
		<br>
		<p></p>
		<button id="k2" class="button" style="background-color:#008CBA;" >K=2</button>
		<button id="k3" class="button" >K=3</button>
		<button id="k4" class="button" >K=4</button>
		<button id="k5" class="button" >K=5</button>
		<button id="k6" class="button" >K=6</button>
		<p></p>
		<p></p>
		<div id="area3"></div>
		
		<script type="text/javascript">

			//Width and height
			var margin = {top: 20, right: 80, bottom: 30, left: 40},
				w = 1024 - margin.left - margin.right,
				h = 500 - margin.top - margin.bottom;
			var padding = 40;
			
			d3.csv("out2003.csv", function(error, data) {

				if (error) {  //If error is not null, something went wrong.
					console.log(error);  //Log the error.
				} else {      //If no error, the file loaded correctly. Yay!
					console.log(data);   //Log the data.

				dataset = data.map(function(d){
					prost = +d.PROSTITUTION
					vehicle = +d["VEHICLE THEFT"]
					district = d.PdDistrict
					
					return [prost, vehicle, district] ;
				});
				
			// colors for districts
			// setup fill color
			var cValue = function(d) { return d[2];},
				color = d3.scale.category10();

			//Create scale functions
			var xScale = d3.scale.linear()
								 .domain([0, d3.max(dataset, function(d) { return d[0]; })+100])
								 .range([padding, w - padding * 4]);

			var yScale = d3.scale.linear()
								 .domain([0, d3.max(dataset, function(d) { return d[1]; })+500])
								 .range([h - padding, padding]);
								 
			var rScale = d3.scale.linear()
								 .domain([0, d3.max(dataset, function(d) { return d[0]+d[1]; })])
								 .range([2, 15]);

			//Define X axis
			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .ticks(8);

			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(8);

			//Create SVG element
			var svg = d3.select("#area1")
						.append("svg")
						.attr("width", w)
						.attr("height", h);
						
			// add the tooltip area to the webpage
			var tooltip = d3.select("#area1").append("div")
							.attr("class", "tooltip")
							.style("opacity", 0);

			//Define clipping path
			svg.append("clipPath")
				.attr("id", "chart-area")
				.append("rect")
				.attr("x", padding)
				.attr("y", padding)
				.attr("width", w - padding * 5)
				.attr("height", h - padding * 2);

			//Create circles
			svg.append("g")
			   .attr("id", "circles")
			   .attr("clip-path", "url(#chart-area)")
			   .selectAll("circle")
			   .data(dataset)
			   .enter()
			   .append("circle")
			   .style("stroke", "black")
			   .attr("cx", function(d) {
			   		return xScale(d[0]);
			   })
			   .attr("cy", function(d) {
			   		return yScale(d[1]);
			   })
			   .attr("fill", function(d) {
			   		return color(cValue(d));
			   })
			   .attr("r", function(d) {
			   		return rScale(d[0]+d[1]);
			   });

			
			//Create X axis
			svg.append("g")
					.attr("class", "x axis")
					.attr("transform", "translate(0," + (h - padding) + ")")
					.call(xAxis)
				.append("text")
					.attr("class", "label")
					.attr("x", w - padding * 4)
					.attr("y", -6)
					.style("text-anchor", "end")
					.text("Prostitution");
			
			//Create Y axis
			svg.append("g")
					.attr("class", "y axis")
					.attr("transform", "translate(" + padding + ",0)")
					.call(yAxis)
				.append("text")
					.attr("class", "label")
					.attr("transform", "rotate(-90)")
					.attr("y", 4)
					.attr("dy", ".71em")
					.style("text-anchor", "end")
					.text("Vehicle Theft");


			d3.selectAll("circle")
				.on("mouseover", function(d) {
					tooltip.transition()
							.duration(200)
							.style("opacity", .9);
					tooltip.html(d[2] + "<br/> (" + d[0] + ", " + d[1] + ")")
							.style("left", (d3.event.pageX + 5) + "px")
							.style("top", (d3.event.pageY - 28) + "px");
				})
				.on("mouseout", function(d) {
					tooltip.transition()
							.duration(500)
							.style("opacity", 0);
				});
			
			// draw legend
			var legend = svg.selectAll(".legend")
							.data(color.domain())
							.enter().append("g")
							.attr("class", "legend")
							.attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

			// draw legend colored rectangles
			legend.append("rect")
					.attr("y", padding)
					.attr("x", w - 18)
					.attr("width", 18)
					.attr("height", 18)
					.style("fill", color);

			// draw legend text
			legend.append("text")
					.attr("y", padding+9)
					.attr("x", w - 24)
					.attr("dy", ".35em")
					.style("text-anchor", "end")
					.text(function(d) { return d;})


			//On click, update with new data			
			d3.selectAll("#button2003, #button2015")
				.on("click", function() {

					//See which button was clicked
					var ID = d3.select(this).attr("id");
					
					//Decide which dataset to load
					if (ID == "button2015") {
						x = document.getElementById("button2003");
						x.style.backgroundColor = "white";
						x.style.color = "black";
						this.style.backgroundColor = "#008CBA";
						updateData("out2015.csv");
					}
					else{
						x = document.getElementById("button2015");
						x.style.backgroundColor = "white";
						x.style.color = "black";
						this.style.backgroundColor = "#008CBA";
						updateData("out2003.csv");
					}	

				});
				
			}
			
		// ** Update data section (Called from the onclick)
		function updateData(s) {

			d3.csv(s, function(error, data) {

				if (error) {  //If error is not null, something went wrong.
					console.log(error);  //Log the error.
				} else {      //If no error, the file loaded correctly. Yay!
					console.log(data);   //Log the data.

				//Include other code to execute after successful file load here
				dataset = data.map(function(d){
					prost = +d.PROSTITUTION
					vehicle = +d["VEHICLE THEFT"]
					district = d.PdDistrict
					
					return [prost, vehicle, district] ;
				});
					
					//Update scale domains
					//Don't update x and y domains since we have static axes!
					//xScale.domain([0, d3.max(dataset, function(d) { return d[0]; })]);
					//yScale.domain([0, d3.max(dataset, function(d) { return d[1]; })]);
					//rScale.domain([0, d3.max(dataset, function(d) { return d[0]+d[1]; })]).range([2, 15]);

					//Update all circles
					svg.selectAll("circle")
					   .data(dataset)
					   .transition()
					   .duration(1000)
					   .ease("linear")
					   .each("start", function() {
						   d3.select(this)
						     .attr("fill", "black")
						     .attr("r", 2);
					   })
					   .attr("cx", function(d) {
					   		return xScale(d[0]);
					   })
					   .attr("cy", function(d) {
					   		return yScale(d[1]);
					   })
					   .each("end", function() {
						   d3.select(this)
						     .transition()
						     .duration(1000)
							.attr("fill", function(d) {
								return color(cValue(d));
							})
							.attr("r", function(d) {
								//find the max value of the whole dataset. Divide by it and multiply by 100
								return (Math.sqrt((d[0]+d[1])/d3.max(dataset, function(d) { return d[0],d[1]; })))*10;
							});
					   });
				}
			});
		}
		
		});
		
		

		</script>
		<script type="text/javascript">

			//Width and height
			//Width and height
			var margin = {top: 20, right: 80, bottom: 30, left: 40},
				w = 1024 - margin.left - margin.right,
				h = 500 - margin.top - margin.bottom;
				
			var padding = 40;
			
			d3.csv("prost.csv", function(error, data) {

				if (error) {  //If error is not null, something went wrong.
					console.log(error);  //Log the error.
				} 
				else {      //If no error, the file loaded correctly. Yay!
					console.log(data);   //Log the data.

				dataset = data.map(function(d){
					return +d.Count ;
				});
				
			// add the tooltip area to the webpage
			var tooltip = d3.select("#area2").append("div")
							.attr("class", "tooltip")
							.style("opacity", 0);
			
			var xScale = d3.scale.ordinal()
							.domain(d3.range(dataset.length))
							.rangeRoundBands([0, w], 0.05);

			var yScale = d3.scale.linear()
							.domain([0, d3.max(dataset)])
							.range([h, 0]);
							
			//Define X axis
			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .tickFormat(function(d) { return d + ":00"; })
							  .ticks(24,"%");

			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(15);
			
			//Create SVG element
			var svg = d3.select("#area2")
						.append("svg")
							.attr("width", w + margin.left + margin.right)
							.attr("height", h + margin.top + margin.bottom)
						.append("g")
							.attr("transform", "translate(" + margin.left + "," + margin.top + ")");;

			//Create bars
			svg.selectAll(".bar")
			   .data(dataset)
			   .enter()
			   .append("rect")
			   .attr("class", "bar")
			   .transition()
			   .duration(500)
			   .delay(function(d, i) {
					return i / dataset.length * 1000;
				})
			   .attr("x", function(d, i) {
			   		return xScale(i);
			   })
			   .attr("y", function(d) {
			   		return yScale(d);
			   })
			   .attr("width", xScale.rangeBand())
			   .attr("height", function(d) {
			   		return (yScale(0)-yScale(d));
			   })
			   .attr("fill", function(d) {
					return "rgb(0, 0, " + d/7 + ")";
			   });
			   
			svg.append("g")
					.attr("class", "x axis")
					.attr("transform", "translate(0," + h + ")")
					.call(xAxis)
				.append("text")
					.attr("class", "label")
					.attr("x", w)
					.attr("y", -6)
					.style("text-anchor", "top")
					.text("Hour of the Day");

			svg.append("g")
					.attr("class", "y axis")
					.call(yAxis)
				.append("text")
				.attr("transform", "rotate(-90)")
				.attr("y", 6)
				.attr("dy", ".71em")
				.style("text-anchor", "end")
				.text("#Incidents");

			d3.selectAll(".bar")
				.on("mouseover", function(d) {
				
					d3.select(this)
						.attr("fill", "orange");
						
					tooltip.transition()
							.duration(200)
							.style("opacity", 1)
							.style("color", "white")
							.style("font-weight", "bold")
							.style("text-shadow", "-1px -1px 0 #000, 1px -1px 0 #000,-1px 1px 0 #000, 1px 1px 0 #000")
							.attr("font-size", "11px");
					tooltip.html(d)
							.style("left", (d3.event.pageX + 1) + "px")
							.style("top", (d3.event.pageY - 58) + "px");
				})
				.on("mouseout", function(d) {
				
					d3.select(this)
						.transition()
						.duration(250)
						.attr("fill", "rgb(0, 0, " + (d/7) + ")");
	  
					tooltip.transition()
							.duration(500)
							.style("opacity", 0);
				});


			//On click, update with new data			
			d3.selectAll("#Prostitution, #VehicleTheft, #Trespass")
				.on("click", function() {

					//See which button was clicked
					var ID = d3.select(this).attr("id");
					
					//Decide which dataset to load
					if (ID == "Prostitution") {
						x = document.getElementById("VehicleTheft");
						x.style.backgroundColor = "white";
						x.style.color = "black";
						y = document.getElementById("Trespass");
						y.style.backgroundColor = "white";
						y.style.color = "black";
						this.style.backgroundColor = "#008CBA";
						updateData("prost.csv");
					}
					else if (ID == "VehicleTheft")  {
						x = document.getElementById("Prostitution");
						x.style.backgroundColor = "white";
						x.style.color = "black";
						y = document.getElementById("Trespass");
						y.style.backgroundColor = "white";
						y.style.color = "black";
						this.style.backgroundColor = "#f44336";
						updateData("vehicle.csv");
					}
					else {
						x = document.getElementById("Prostitution");
						x.style.backgroundColor = "white";
						x.style.color = "black";
						y = document.getElementById("VehicleTheft");
						y.style.backgroundColor = "white";
						y.style.color = "black";
						this.style.backgroundColor = "#4CAF50";
						updateData("trespass.csv");
					}					
						   				
				});
			}
			
			
		// ** Update data section (Called from the onclick)
		function updateData(s) {

			d3.csv(s, function(error, data) {

				if (error) {  //If error is not null, something went wrong.
					console.log(error);  //Log the error.
				} else {      //If no error, the file loaded correctly. Yay!
					console.log(data);   //Log the data.

				dataset = data.map(function(d){
					return +d.Count ;
				});
				
				//Update scale domain
					//Recalibrate the scale domain, given the new max value in dataset
					yScale.domain([0, d3.max(dataset)]);

					//Update all rects
					svg.selectAll(".bar")
					   .data(dataset)
					   .attr("class", "bar")
					   .transition()
					   .delay(function(d, i) {
						   return i / dataset.length * 1000;
					   })
					   .duration(500)
					   .attr("y", function(d) {
					   		return yScale(d);
					   })
					   .attr("height", function(d) {
					   		return (yScale(0)-yScale(d));
					   })
					   .attr("fill", function(d) {
							if (s=="prost.csv"){
								return "rgb(0, 0, " + d/7 + ")";
							}
							else if (s=="vehicle.csv"){
								return "rgb("+d/35+", 0, 0 )";
							}
							else{
								return "rgb(0,"+d/4+",0)";
							}
					   });
					   
				d3.selectAll(".bar")
				.on("mouseout", function(d) {

					d3.select(this)
						.transition()
						.duration(250)
						.attr("fill", function(d) {
							if (s=="prost.csv"){
								return "rgb(0, 0, " + d/7 + ")";
							}
							else if (s=="vehicle.csv"){
								return "rgb("+d/35+", 0, 0 )";
							}
							else{
								return "rgb(0,"+d/4+",0)";
							}});
	  
					tooltip.transition()
							.duration(500)
							.style("opacity", 0);
				});
					   
					//Update X axis
					svg.select(".x.axis")
				    	.transition()
				    	.duration(1000)
						.call(xAxis);
					
					//Update Y axis
					svg.select(".y.axis")
				    	.transition()
				    	.duration(1000)
						.call(yAxis);


				}
			});
		}
		});

			
		</script>
		
		<script type="text/javascript">
			//Width and height
			//Width and height
			var margin = {top: 20, right: 80, bottom: 30, left: 40},
				w = 1024 - margin.left - margin.right,
				h = 600 - margin.top - margin.bottom;
			var padding = 40;
			
			var projection = d3.geo.mercator();
			
			var color = d3.scale.category10();
			
			var path = d3.geo.path().projection(projection);
							
			//Create SVG element
			var svg = d3.select("#area3")
						.append("svg")
						.attr("width", w)
						.attr("height", h);
							
			//Load in GeoJSON data
			d3.json("sfpddistricts.json", function(json) {

				projection
						.scale(1)
						.translate([0, 0]);
				//Find the corresponding state inside the GeoJSON
				var left = 1000 , top = -1000, right = -1000, bottom = 1000;
				for (var j = 0; j < json.features.length; j++) {

					var jsonState = json.features[j];
					var bstate = path.bounds(jsonState)
					if (bstate[0][0]<left){
						left = bstate[0][0];
					}
					if (bstate[0][1]>top){
						top = bstate[0][1];
					}
					if (bstate[1][0]>right){
						right = bstate[1][0];
					}
					if (bstate[1][1]<bottom){
						bottom = bstate[1][1];
					}
					
					
					
				}
	
				var b = [[left-0.0008,top+0.0008],[right+0.0008,bottom-0.0008]],
				s = .95 / Math.max((b[1][0] - b[0][0]) / w, (b[1][1] - b[0][1]) / h),
				t = [(w - s * (b[1][0] + b[0][0])) / 2, (h - s * (b[1][1] + b[0][1])) / 2];

				projection
					.scale(s)
					.translate(t)
					;
					
	
				
				//Bind data and create one path per GeoJSON feature
				svg.selectAll("path")
				   .data(json.features)
				   .enter()
				   .append("path")
				   .attr("d", path)
				   .style("stroke", "black")
				   .style("stroke-width", "1")
				   .style("fill", "#9ecae1")
				
				//Add corresponding district name
				svg.selectAll("text")
                .data(json.features)
                .enter()
                .append("text")
                .text(function(d){
					console.log(d.properties.DISTRICT)
                    return d.properties.DISTRICT;
                })
				.attr("x", function(d){
                    return path.centroid(d)[0];
                })
                .attr("y", function(d){
                    return  path.centroid(d)[1];
                })
                .attr("text-anchor","middle")
                .attr('font-size','20px')
                .attr('font-family','sans-serif')
                .attr('fill','black');
				
				//Load in cities data
				d3.csv("labeled_data2.csv", function(data) {
					svg.selectAll(".point")
						.data(data)
						.enter()
						.append("circle")
						.attr("class", "point")
						.attr("cx", function(d) {
							return projection([d.lon, d.lat])[0];
						})
						.attr("cy", function(d) {
							return projection([d.lon, d.lat])[1];
						})
						.attr("r", 5)
						.attr("fill", function(d) {
							return color(d.label);		
						})
						.style("opacity", 0.75);
						
					d3.csv("centroid2.csv", function(data) {
						
						svg.selectAll(".centroid")
							.data(data)
							.enter()
							.append("circle")
							.attr("class", "centroid")
							.attr("cx", function(d) {
								return projection([d.lon, d.lat])[0];
							})
							.attr("cy", function(d) {
								return projection([d.lon, d.lat])[1];
							})
							.attr("r", 15)
							.attr("fill", function(d,i) {
								return color(i);
								
							})
							.style("opacity", 1)
							.style("stroke", "black")
							.style("stroke-width", "1");
						
					});
						
				});
				var ID="k2";
				var hoverID;
				//On click, update with new data			
				d3.selectAll("#k2, #k3, #k4, #k5, #k6")
				.on("click", function() {

					//See which button was clicked
					ID = d3.select(this).attr("id");
					
					//Decide which dataset to load
					if (ID == "k2") {
						x = document.getElementById("k3");
						x.style.backgroundColor = "white";
						x.style.color = "black";
						y = document.getElementById("k4");
						y.style.backgroundColor = "white";
						y.style.color = "black";
						z = document.getElementById("k5");
						z.style.backgroundColor = "white";
						z.style.color = "black";
						w = document.getElementById("k6");
						w.style.backgroundColor = "white";
						w.style.color = "black";
						this.style.backgroundColor = "#008CBA";
						updateData("2");
					}
					else if (ID == "k3")  {
						x = document.getElementById("k2");
						x.style.backgroundColor = "white";
						x.style.color = "black";
						y = document.getElementById("k4");
						y.style.backgroundColor = "white";
						y.style.color = "black";
						z = document.getElementById("k5");
						z.style.backgroundColor = "white";
						z.style.color = "black";
						w = document.getElementById("k6");
						w.style.backgroundColor = "white";
						w.style.color = "black";
						this.style.backgroundColor = "#008CBA";
						updateData("3");
					}
					else if (ID == "k4")  {
						x = document.getElementById("k2");
						x.style.backgroundColor = "white";
						x.style.color = "black";
						y = document.getElementById("k3");
						y.style.backgroundColor = "white";
						y.style.color = "black";
						z = document.getElementById("k5");
						z.style.backgroundColor = "white";
						z.style.color = "black";
						w = document.getElementById("k6");
						w.style.backgroundColor = "white";
						w.style.color = "black";
						this.style.backgroundColor = "#008CBA";
						updateData("4");
					}
					else if (ID == "k5")  {
						x = document.getElementById("k2");
						x.style.backgroundColor = "white";
						x.style.color = "black";
						y = document.getElementById("k3");
						y.style.backgroundColor = "white";
						y.style.color = "black";
						z = document.getElementById("k4");
						z.style.backgroundColor = "white";
						z.style.color = "black";
						w = document.getElementById("k6");
						w.style.backgroundColor = "white";
						w.style.color = "black";
						this.style.backgroundColor = "#008CBA";
						updateData("5");
					}
					else if (ID == "k6")  {
						x = document.getElementById("k2");
						x.style.backgroundColor = "white";
						x.style.color = "black";
						y = document.getElementById("k3");
						y.style.backgroundColor = "white";
						y.style.color = "black";
						z = document.getElementById("k4");
						z.style.backgroundColor = "white";
						z.style.color = "black";
						w = document.getElementById("k5");
						w.style.backgroundColor = "white";
						w.style.color = "black";
						this.style.backgroundColor = "#008CBA";
						updateData("6");
					}								

				})
				.on("mouseover", function() {
				
					//See which button was hovered
					hoverID = d3.select(this).attr("id");
					console.log(ID+" " +hoverID);
					if(hoverID!=ID){
						//Decide which dataset to preview
						if (hoverID == "k2") {
							updateData("2");
						}
						else if (hoverID == "k3")  {
							updateData("3");
						}
						else if (hoverID == "k4")  {
							updateData("4");
						}
						else if (hoverID == "k5")  {
							updateData("5");
						}
						else if (hoverID == "k6")  {
							updateData("6");
						}
					}

				})
				.on("mouseout", function() {
				
					if(hoverID!=ID){
						//Return to actual dataset
						if (ID == "k2") {
							updateData("2");
						}
						else if (ID == "k3")  {
							updateData("3");
						}
						else if (ID == "k4")  {
							updateData("4");
						}
						else if (ID == "k5")  {
							updateData("5");
						}
						else if (ID == "k6")  {
							updateData("6");
						}
					}
				});
				
				// ** Update data section (Called from the onclick)
				function updateData(s) {

				//Load in cities data
				d3.csv("labeled_data"+s+".csv", function(data) {
					svg.selectAll(".point")
						.data(data)
						.attr("class", "point")
						.transition()
						.delay(function(d, i) {
								return i / data.length * 500;
						})
						.duration(1000)
						.attr("cx", function(d) {
							return projection([d.lon, d.lat])[0];
						})
						.attr("cy", function(d) {
							return projection([d.lon, d.lat])[1];
						})
						.attr("r", 5)
						.attr("fill", function(d) {
							return color(d.label);		
						})
						.style("opacity", 0.75);

					d3.csv("centroid"+s+".csv", function(data) {
						svg.selectAll(".centroid").remove();
						svg.selectAll(".centroid")
							.data(data)
							.enter()
							.append("circle")
							.attr("class", "centroid")
							.transition()
							.delay(function(d, i) {
								return i*200;
							})
							.duration(1000)
							.ease("linear")
							.attr("cx", function(d) {
								return projection([d.lon, d.lat])[0];
							})
							.attr("cy", function(d) {
								return projection([d.lon, d.lat])[1];
							})
							.attr("r", 15)
							.attr("fill", function(d,i) {
								return color(i);
								
							})
							.style("opacity", 1)
							.style("stroke", "black")
							.style("stroke-width", "1");
					});	
						
				});

				}
		
			});
					
		</script>
	</div>
	</body>
</html>