<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Visualizing Crime Data in San Fransisco</title>
		<script type="text/javascript" src="../d3/d3.js"></script>
		<style type="text/css">
			
			.axis path,
			.axis line {
				fill: none;
				stroke: black;
				shape-rendering: crispEdges;
			}
			
			.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}
			
			.tooltip {
				position: absolute;
				width: 200px;
				height: 28px;
				pointer-events: none;
			}
			
			.dot {
				stroke: #000;
			}
			
			.button {
				display: inline-block;
				padding: 12px 16px;
				font-size: 15px;
				cursor: pointer;
				text-align: center;	
				text-decoration: none;
				outline: none;
				box-shadow: 0 1px #999;
				background-color: white; 
				color: black; 
				border: 2px solid #555555;
			}

			.button:active {
				transform: translateY(2px);
			}
			
			.bar:hover {
				fill: #FFCC33;
			}

		</style>
	</head>
	<body>
		<h1>Visualizing Crime Data in San Fransisco</h1>
		<h2>Number of Prostitution and Vehicle Theft Incidents in San Fransisco Districts</h2>
		<p></p>
		<p>The following visualization consists of an interactive <b>scatterplot</b>, depicting the number of <b>Prostitution</b> and <b>Vehicle Theft</b> Incidents
			in San Fransisco. <br>
			<li>You can freely toggle between year 2003 and 2015 and see how the number of incidents changed between these two years.</li>
			<li>You can hover over every district point and see details about the district and the number of incidents of each type of crime separately</li>
		</p>
		<p></p>
		<button id="button2003" class="button" style="background-color:#008CBA;" >2003</button>
		<button id="button2015" class="button" >2015</button>
		<p></p>
		<div id="area1"></div>
		
		<p><br></p>
		<p></p>
		
		<h2>Evolution of Crimes in San Fransisco by hour</h2>
		<p></p>
		<p>The following visualization consists of an interactive <b>histogram</b>, depicting the number of <b>Prostitution</b>, <b>Vehicle Theft</b>  
			and <b>Trespass</b> Incidents in San Fransisco by hour. <br>
			<li>You can freely toggle between different crimes and see how the number of incidents changes during the day.</li>
			<li>You can hover over every bar to highlight it and see detailed number of incidents.</li>
		</p>
		<p></p>
		<button id="Prostitution" class="button" style="background-color:#008CBA;" >Prostitution</button>
		<button id="VehicleTheft" class="button" >Vehicle Theft</button>
		<button id="Trespass" class="button" >Trespass</button>
		<p></p>
		<p></p>
		<div id="area2"></div>
	
		<script type="text/javascript">

			//Width and height
			var margin = {top: 20, right: 20, bottom: 30, left: 40},
				w = 1024 - margin.left - margin.right,
				h = 500 - margin.top - margin.bottom;
			var padding = 40;
			
			d3.csv("out2003.csv", function(error, data) {

				if (error) {  //If error is not null, something went wrong.
					console.log(error);  //Log the error.
				} else {      //If no error, the file loaded correctly. Yay!
					console.log(data);   //Log the data.

				dataset = data.map(function(d){
					prost = +d.PROSTITUTION
					vehicle = +d["VEHICLE THEFT"]
					district = d.PdDistrict
					
					return [prost, vehicle, district] ;
				});
				
			// colors for districts
			// setup fill color
			var cValue = function(d) { return d[2];},
				color = d3.scale.category10();

			//Create scale functions
			var xScale = d3.scale.linear()
								 .domain([0, d3.max(dataset, function(d) { return d[0]; })+100])
								 .range([padding, w - padding * 4]);

			var yScale = d3.scale.linear()
								 .domain([0, d3.max(dataset, function(d) { return d[1]; })+500])
								 .range([h - padding, padding]);
								 
			var rScale = d3.scale.linear()
								 .domain([0, d3.max(dataset, function(d) { return d[0]+d[1]; })])
								 .range([2, 15]);

			//Define X axis
			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .ticks(8);

			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(8);

			//Create SVG element
			var svg = d3.select("#area1")
						.append("svg")
						.attr("width", w)
						.attr("height", h);
						
			// add the tooltip area to the webpage
			var tooltip = d3.select("#area1").append("div")
							.attr("class", "tooltip")
							.style("opacity", 0);

			//Define clipping path
			svg.append("clipPath")
				.attr("id", "chart-area")
				.append("rect")
				.attr("x", padding)
				.attr("y", padding)
				.attr("width", w - padding * 5)
				.attr("height", h - padding * 2);

			//Create circles
			svg.append("g")
			   .attr("id", "circles")
			   .attr("clip-path", "url(#chart-area)")
			   .selectAll("circle")
			   .data(dataset)
			   .enter()
			   .append("circle")
			   .style("stroke", "black")
			   .attr("cx", function(d) {
			   		return xScale(d[0]);
			   })
			   .attr("cy", function(d) {
			   		return yScale(d[1]);
			   })
			   .attr("fill", function(d) {
			   		return color(cValue(d));
			   })
			   .attr("r", function(d) {
			   		return rScale(d[0]+d[1]);
			   });

			
			//Create X axis
			svg.append("g")
					.attr("class", "x axis")
					.attr("transform", "translate(0," + (h - padding) + ")")
					.call(xAxis)
				.append("text")
					.attr("class", "label")
					.attr("x", w - padding * 4)
					.attr("y", -6)
					.style("text-anchor", "end")
					.text("Prostitution");
			
			//Create Y axis
			svg.append("g")
					.attr("class", "y axis")
					.attr("transform", "translate(" + padding + ",0)")
					.call(yAxis)
				.append("text")
					.attr("class", "label")
					.attr("transform", "rotate(-90)")
					.attr("y", 4)
					.attr("dy", ".71em")
					.style("text-anchor", "end")
					.text("Vehicle Theft");


			d3.selectAll("circle")
				.on("mouseover", function(d) {
					tooltip.transition()
							.duration(200)
							.style("opacity", .9);
					tooltip.html(d[2] + "<br/> (" + d[0] + ", " + d[1] + ")")
							.style("left", (d3.event.pageX + 5) + "px")
							.style("top", (d3.event.pageY - 28) + "px");
				})
				.on("mouseout", function(d) {
					tooltip.transition()
							.duration(500)
							.style("opacity", 0);
				});
			
			// draw legend
			var legend = svg.selectAll(".legend")
							.data(color.domain())
							.enter().append("g")
							.attr("class", "legend")
							.attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

			// draw legend colored rectangles
			legend.append("rect")
					.attr("y", padding)
					.attr("x", w - 18)
					.attr("width", 18)
					.attr("height", 18)
					.style("fill", color);

			// draw legend text
			legend.append("text")
					.attr("y", padding+9)
					.attr("x", w - 24)
					.attr("dy", ".35em")
					.style("text-anchor", "end")
					.text(function(d) { return d;})


			//On click, update with new data			
			d3.selectAll("#button2003, #button2015")
				.on("click", function() {

					//See which button was clicked
					var ID = d3.select(this).attr("id");
					
					//Decide which dataset to load
					if (ID == "button2015") {
						x = document.getElementById("button2003");
						x.style.backgroundColor = "white";
						x.style.color = "black";
						this.style.backgroundColor = "#008CBA";
						updateData("out2015.csv");
					}
					else{
						x = document.getElementById("button2015");
						x.style.backgroundColor = "white";
						x.style.color = "black";
						this.style.backgroundColor = "#008CBA";
						updateData("out2003.csv");
					}	

				});
				
			}
			
		// ** Update data section (Called from the onclick)
		function updateData(s) {

			d3.csv(s, function(error, data) {

				if (error) {  //If error is not null, something went wrong.
					console.log(error);  //Log the error.
				} else {      //If no error, the file loaded correctly. Yay!
					console.log(data);   //Log the data.

				//Include other code to execute after successful file load here
				dataset = data.map(function(d){
					prost = +d.PROSTITUTION
					vehicle = +d["VEHICLE THEFT"]
					district = d.PdDistrict
					
					return [prost, vehicle, district] ;
				});
					
					//Update scale domains
					//Don't update x and y domains since we have static axes!
					//xScale.domain([0, d3.max(dataset, function(d) { return d[0]; })]);
					//yScale.domain([0, d3.max(dataset, function(d) { return d[1]; })]);
					//rScale.domain([0, d3.max(dataset, function(d) { return d[0]+d[1]; })]).range([2, 15]);

					//Update all circles
					svg.selectAll("circle")
					   .data(dataset)
					   .transition()
					   .duration(1000)
					   .ease("linear")
					   .each("start", function() {
						   d3.select(this)
						     .attr("fill", "black")
						     .attr("r", 2);
					   })
					   .attr("cx", function(d) {
					   		return xScale(d[0]);
					   })
					   .attr("cy", function(d) {
					   		return yScale(d[1]);
					   })
					   .each("end", function() {
						   d3.select(this)
						     .transition()
						     .duration(1000)
							.attr("fill", function(d) {
								return color(cValue(d));
							})
							.attr("r", function(d) {
								//find the max value of the whole dataset. Divide by it and multiply by 100
								return (Math.sqrt((d[0]+d[1])/d3.max(dataset, function(d) { return d[0],d[1]; })))*10;
							});
					   });
				}
			});
		}
		
		});
		
		

		</script>
		<script type="text/javascript">

			//Width and height
			//Width and height
			var margin = {top: 20, right: 20, bottom: 30, left: 40},
				w = 1024 - margin.left - margin.right,
				h = 500 - margin.top - margin.bottom;
				
			var padding = 40;
			
			d3.csv("prost.csv", function(error, data) {

				if (error) {  //If error is not null, something went wrong.
					console.log(error);  //Log the error.
				} 
				else {      //If no error, the file loaded correctly. Yay!
					console.log(data);   //Log the data.

				dataset = data.map(function(d){
					return +d.Count ;
				});
				
			// add the tooltip area to the webpage
			var tooltip = d3.select("#area2").append("div")
							.attr("class", "tooltip")
							.style("opacity", 0);
			
			var xScale = d3.scale.ordinal()
							.domain(d3.range(dataset.length))
							.rangeRoundBands([0, w], 0.05);

			var yScale = d3.scale.linear()
							.domain([0, d3.max(dataset)])
							.range([h, 0]);
							
			//Define X axis
			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .ticks(24,"%");

			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(15);
			
			//Create SVG element
			var svg = d3.select("#area2")
						.append("svg")
							.attr("width", w + margin.left + margin.right)
							.attr("height", h + margin.top + margin.bottom)
						.append("g")
							.attr("transform", "translate(" + margin.left + "," + margin.top + ")");;
						
			svg.append("g")
					.attr("class", "x axis")
					.attr("transform", "translate(0," + h + ")")
					.call(xAxis)
				.append("text")
					.attr("class", "label")
					.attr("x", w)
					.attr("y", 500 - margin.top - margin.bottom)
					.style("text-anchor", "end")
					.text("Hour of the Day");

			svg.append("g")
					.attr("class", "y axis")
					.call(yAxis)
				.append("text")
				.attr("transform", "rotate(-90)")
				.attr("y", 6)
				.attr("dy", ".71em")
				.style("text-anchor", "end")
				.text("#Incidents");

			//Create bars
			svg.selectAll(".bar")
			   .data(dataset)
			   .enter()
			   .append("rect")
			   .attr("class", "bar")
			   .transition()
			   .duration(500)
			   .delay(function(d, i) {
					return i / dataset.length * 1000;
				})
			   .attr("x", function(d, i) {
			   		return xScale(i);
			   })
			   .attr("y", function(d) {
			   		return yScale(d);
			   })
			   .attr("width", xScale.rangeBand())
			   .attr("height", function(d) {
			   		return (yScale(0)-yScale(d));
			   })
			   .attr("fill", function(d) {
					return "rgb(0, 0, " + d/7 + ")";
			   });

			d3.selectAll("rect")
				.on("mouseover", function(d) {
					tooltip.transition()
							.duration(200)
							.style("opacity", 1)
							.style("color", "white")
							.style("font-weight", "bold")
							.style("text-shadow", "-1px -1px 0 #000, 1px -1px 0 #000,-1px 1px 0 #000, 1px 1px 0 #000")
							.attr("font-size", "11px");
					tooltip.html(d)
							.style("left", (d3.event.pageX + 1) + "px")
							.style("top", (d3.event.pageY - 58) + "px");
				})
				.on("mouseout", function(d) {
					tooltip.transition()
							.duration(500)
							.style("opacity", 0);
				});


			//On click, update with new data			
			d3.selectAll("#Prostitution, #VehicleTheft, #Trespass")
				.on("click", function() {

					//See which button was clicked
					var ID = d3.select(this).attr("id");
					
					//Decide which dataset to load
					if (ID == "Prostitution") {
						x = document.getElementById("VehicleTheft");
						x.style.backgroundColor = "white";
						x.style.color = "black";
						y = document.getElementById("Trespass");
						y.style.backgroundColor = "white";
						y.style.color = "black";
						this.style.backgroundColor = "#008CBA";
						updateData("prost.csv");
					}
					else if (ID == "VehicleTheft")  {
						x = document.getElementById("Prostitution");
						x.style.backgroundColor = "white";
						x.style.color = "black";
						y = document.getElementById("Trespass");
						y.style.backgroundColor = "white";
						y.style.color = "black";
						this.style.backgroundColor = "#f44336";
						updateData("vehicle.csv");
					}
					else {
						x = document.getElementById("Prostitution");
						x.style.backgroundColor = "white";
						x.style.color = "black";
						y = document.getElementById("VehicleTheft");
						y.style.backgroundColor = "white";
						y.style.color = "black";
						this.style.backgroundColor = "#4CAF50";
						updateData("trespass.csv");
					}					
						   				
				});
			}
			
			
					// ** Update data section (Called from the onclick)
		function updateData(s) {

			d3.csv(s, function(error, data) {

				if (error) {  //If error is not null, something went wrong.
					console.log(error);  //Log the error.
				} else {      //If no error, the file loaded correctly. Yay!
					console.log(data);   //Log the data.

				dataset = data.map(function(d){
					return +d.Count ;
				});
				
				//Update scale domain
					//Recalibrate the scale domain, given the new max value in dataset
					yScale.domain([0, d3.max(dataset)]);

					//Update all rects
					svg.selectAll(".bar")
					   .data(dataset)
					   .attr("class", "bar")
					   .transition()
					   .delay(function(d, i) {
						   return i / dataset.length * 1000;
					   })
					   .duration(500)
					   .attr("y", function(d) {
					   		return yScale(d);
					   })
					   .attr("height", function(d) {
					   		return (yScale(0)-yScale(d));
					   })
					   .attr("fill", function(d) {
							if (s=="prost.csv"){
								return "rgb(0, 0, " + d/7 + ")";
							}
							else if (s=="vehicle.csv"){
								return "rgb("+d/35+", 0, 0 )";
							}
							else{
								return "rgb(0,"+d/4+",0)";
							}
					   });
					   
					//Update X axis
					svg.select(".x.axis")
				    	.transition()
				    	.duration(1000)
						.call(xAxis);
					
					//Update Y axis
					svg.select(".y.axis")
				    	.transition()
				    	.duration(1000)
						.call(yAxis);


				}
			});
		}
		});

			
		</script>
	</body>
</html>

